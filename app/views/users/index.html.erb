<ul class="nav nav-tabs mb-3">
  <li class="nav-item">
    <a class="nav-link active" href="<%= users_path %>"><h5>Users</h5></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="<%= roles_path %>"><h5>Roles</h5></a>
  </li>
</ul>

<table class="table table-bordered">
  <thead class="thead-light">
    <tr>
      <th style="width: 10%">Email</th>
      <th style="width: 10%">Roles</th>
      <th style="width: 25%">Permissions</th>
      <th style="width: 15%">Created At</th>
      <th style="width: 15%">Updated At</th>
      <th style="width: 20%">Action</th>
    </tr>
  </thead>

  <tbody>
    <% @users.each_with_index do |user, index| %>
      <tr>
        <td><%= user.email %></td>
        <td>
          <ul class="list-group">
            <% user.roles.each do |role| %>
              <li class="list-group-item"><%= role.name %></li>
            <% end %>
          </ul>
        </td>
        <td>
          <% unless user.permissions.empty? %>
            <div id="accordion<%=index%>">
              <% user.permission_types.each do |permission_type| %>
                <div class="card">
                  <div class="card-header" id="header<%=index%><%= permission_type.permissible_type %>">
                    <h5 class="mb-0">
                      <button class="btn btn-link" data-toggle="collapse" data-target="#<%= permission_type.permissible_type %><%=index%>" aria-expanded="true" aria-controls="collapseOne">
                        <b><%= permission_type.permissible_type %></b>
                      </button>
                    </h5>
                  </div>
                  <div id="<%= permission_type.permissible_type %><%=index%>" class="collapse" aria-labelledby="heading<%= permission_type.permissible_type %>" data-parent="#accordion<%=index%>">
                    <div class="card-body">
                      <ul class="ul-permission">
                        <% user.permissions.where(
                              permissible_type: permission_type.permissible_type
                            ).sort_by{|p| p.permissible.to_s}.each do |permission| %>
                          <li>
                            <span class="fa fa-chevron-right"></span>
                            &nbsp<%= permission.permissible.to_s %>
                          </li>
                        <% end %>
                      </ul>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </td>
        <td><%= user.created_at.strftime("%B %d, %Y %H:%M") %></td>
        <td><%= user.updated_at.strftime("%B %d, %Y %H:%M") %></td>
        <td>
          <%= link_to user, class: 'btn btn-light btn-sm', type: 'button' do %>
            <span class="fa fa-search-plus"></span>
            Show
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
